@page "/tag/edit/{entityId:long}"

@inject ITagRepository _entityRepository

@attribute [Authorize(Roles = "Admin")]

@if (entity != null)
{
    <TagForm entity="entity" Action="@T["Action_Edit"]" onValidSubmit="Edit" isBusy="isBusy" />
}
@code {
    [Parameter] public long entityId { get; set; }
    bool isBusy = false;
    public Tag entity;
    protected async override Task OnInitializedAsync()
    {
        entity = await _entityRepository.Get(entityId);

        if (entity == null)
        {
            _navigationManager.NavigateTo("NotFound");
            return;
        }
    }

    private async Task Edit()
    {
        try
        {
            isBusy = true;
            EditTagVMRequest tagVM = new()
            {
                Id = entity.Id,
                Name_ar = entity.Name_ar,
                Name_en = entity.Name_en,
                Name_fr = entity.Name_fr,
                Name_tr = entity.Name_tr,
                Name_ru = entity.Name_ru,
            };
            await _entityRepository.Edit(tagVM);
            _navigationManager.NavigateTo("tags");
            Toaster.Info(T["Message_Update"]);
        }
        catch (Exception ex)
        {
            isBusy = false;

            Toaster.Error(T["Message_Error"]);
            await _homeRepository.LogToDB(new LogDTO() { Page = _navigationManager.Uri, Message = ex.Message, StackTrace = ex.StackTrace, InnerException = ex.InnerException?.ToString() });
        }
    }
}
